name: Keep Render Alive

on:
  schedule:
    # Executa a cada 10 minutos (cron: minuto hora dia mÃªs dia-da-semana)
    # Render dorme apÃ³s 15 minutos de inatividade, entÃ£o 10min Ã© seguro
    - cron: '*/10 * * * *'

  # Permite execuÃ§Ã£o manual via GitHub Actions UI
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping health check endpoint
        run: |
          echo "ðŸ“ Fazendo ping no servidor para manter ativo..."

          # Fazer requisiÃ§Ã£o ao health check endpoint
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" https://lista-presentes-0hbp.onrender.com/health/)

          if [ "$RESPONSE" -eq 200 ]; then
            echo "âœ… Servidor respondeu com sucesso! Status: $RESPONSE"
          else
            echo "âš ï¸ Servidor respondeu com status: $RESPONSE"
            exit 1
          fi

          echo "â° PrÃ³ximo ping em 10 minutos..."
          echo "ðŸ“Š Timestamp: $(date '+%Y-%m-%d %H:%M:%S UTC')"

      - name: Verificar uptime
        run: |
          echo "ðŸ“ˆ EstatÃ­sticas do servidor:"

          # Medir tempo de resposta
          START_TIME=$(date +%s%N)
          curl -s https://lista-presentes-0hbp.onrender.com/health/ > /dev/null
          END_TIME=$(date +%s%N)

          # Calcular latÃªncia em milissegundos
          LATENCY=$(( ($END_TIME - $START_TIME) / 1000000 ))

          echo "âš¡ LatÃªncia: ${LATENCY}ms"

          if [ "$LATENCY" -lt 1000 ]; then
            echo "ðŸŸ¢ LatÃªncia excelente (< 1s)"
          elif [ "$LATENCY" -lt 3000 ]; then
            echo "ðŸŸ¡ LatÃªncia boa (< 3s)"
          else
            echo "ðŸ”´ LatÃªncia alta (> 3s)"
          fi
