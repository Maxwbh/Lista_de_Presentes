#!/bin/bash
# Pre-commit hook: Auto-increment version and set commit author
# This hook ensures every commit updates the version number and is attributed to @Maxwbh

set -e

echo "üîß Pre-commit hook: Auto-versioning and author attribution"

# Check if VERSION file exists
if [ ! -f "VERSION" ]; then
    echo "‚ùå VERSION file not found!"
    exit 1
fi

# Read current version
CURRENT_VERSION=$(cat VERSION)
echo "üì¶ Current version: $CURRENT_VERSION"

# Parse version (format: MAJOR.MINOR.PATCH)
IFS='.' read -r MAJOR MINOR PATCH <<< "$CURRENT_VERSION"

# Check if version was already manually updated in this commit
if git diff --cached --name-only | grep -q "^VERSION$"; then
    echo "‚úì VERSION file already staged (manual update detected)"
else
    # Auto-increment patch version
    PATCH=$((PATCH + 1))
    NEW_VERSION="$MAJOR.$MINOR.$PATCH"

    # Update VERSION file
    echo "$NEW_VERSION" > VERSION

    # Stage VERSION file
    git add VERSION

    echo "‚úÖ Version auto-incremented: $CURRENT_VERSION ‚Üí $NEW_VERSION"
fi

# Set commit author to @Maxwbh
export GIT_AUTHOR_NAME="Maxwell Oliveira"
export GIT_AUTHOR_EMAIL="maxwbh@gmail.com"
export GIT_COMMITTER_NAME="Maxwell Oliveira"
export GIT_COMMITTER_EMAIL="maxwbh@gmail.com"

echo "üë§ Commit author: Maxwell Oliveira <maxwbh@gmail.com>"
echo "‚úÖ Pre-commit hook completed successfully"

exit 0
